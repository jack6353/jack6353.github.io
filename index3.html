<html>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Chicle|Dekko|Englebert|Indie+Flower|Rhodium+Libre|Sail|Yatra+One" rel="stylesheet">
<script src="https://d3js.org/d3.v3.min.js"></script>

<style> /* set the CSS */

.header-text {
  text-align: center;
  border: 3px solid black;
  margin: 30px 50px 0 50px;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 4px;
}

.title-font {
  font-family: Dekko;
  font-size: 50px;
  margin: 10px;
}

.message-font {
  margin: 30px 50px 50px 50px;
  font-family: Rhodium Libre;
  font-size: 20px;
  padding: 20px;
  background-color: #EEE;
  text-align: left;
  
}

.button-font {
  font-family: Chicle;
  font-size: 25px;
  margin: 0px;
  text-align: center;
}

.button-font:hover {
  background-color: #CCF;
  border-color: #00F;
  
}

@keyframes fadeIn {
 0% {opacity: 0;}
 100% {opacity: 1;}
}

p {
  font-size: 30px;
  font-family: Dekko;
  background-color: #CFC;
  margin-left: 600px;
  margin-right: 600px;
  color: blue
}

.text-center {
  margin: 30px 50px 0 50px;
  text-align: center;
}

svg {
  display: block;
  margin: auto;

}

.grid line {
  stroke: grey;
  stroke-opacity: 0.3;
  shape-rendering: crispEdges
}
.grid path {
  stroke-width: 0;
}

body {
  font: 10px sans-serif;
}
select {
  display: block;
}
.bar {
  fill: purple;
  opacity: 0.8;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

</style>


<body>
  <div class="header-text">
    <h1 class="title-font">
      Mobile Facts in USA - Ownership by Other Categories
    </h1>
  </div>
  <div id="message" class="message-font message">A substantial majority of Americans are cellphone owners across a wide range of demographic groups. By contrast, smartphone ownership exhibits greater variation based on age, household income and educational attainment.</div>
  <!-- load the d3.js library -->     
  <div id="chart"></div>
  
  <div id='vis-container'></div>
  <script>
            // Load and munge data, then make the visualization.
            var fileName = "https://jack6353.github.io/cereal-detailed.csv";
            var nutritionFields = ["calories", "protein", "fat", "sodium", "fiber",
            "carbs", "sugars", "potassium", "vitamins"];

            d3.csv(fileName, function(error, data) {
              var cerealMap = {};
              data.forEach(function(d) {
                var cereal = d.cereal;
                cerealMap[cereal] = [];

                    // { cerealName: [ bar1Val, bar2Val, ... ] }
                    nutritionFields.forEach(function(field) {
                      cerealMap[cereal].push( +d[field] );
                    });
                  });
              makeVis(cerealMap);
            });

            d3.csv(fileName, function(error, data) {
              var cerealMap = {};
              data.forEach(function(d) {
                var cereal = d.cereal;
                cerealMap[cereal] = [];

                    // { cerealName: [ bar1Val, bar2Val, ... ] }
                    nutritionFields.forEach(function(field) {
                      cerealMap[cereal].push( +d[field] );
                    });
                  });
              makeVis(cerealMap);
            });

            d3.csv(fileName, function(error, data) {
              var cerealMap = {};
              data.forEach(function(d) {
                var cereal = d.cereal;
                cerealMap[cereal] = [];

                    // { cerealName: [ bar1Val, bar2Val, ... ] }
                    nutritionFields.forEach(function(field) {
                      cerealMap[cereal].push( +d[field] );
                    });
                  });
              makeVis(cerealMap);
            });

            var makeVis = function(cerealMap) {
                // Define dimensions of vis
                var margin = { top: 30, right: 50, bottom: 30, left: 50 },
                width  = 550 - margin.left - margin.right,
                height = 250 - margin.top  - margin.bottom;

                // Make x scale
                var xScale = d3.scale.ordinal()
                .domain(nutritionFields)
                .rangeRoundBands([0, width], 0.1);

                // Make y scale, the domain will be defined on bar update
                var yScale = d3.scale.linear()
                .range([height, 0]);

                // Create canvas
                var canvas = d3.select("#vis-container")
                .append("svg")
                .attr("width",  width  + margin.left + margin.right)
                .attr("height", height + margin.top  + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                // Make x-axis and add to canvas
                var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient("bottom");

                canvas.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

                // Make y-axis and add to canvas
                var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left");

                var yAxisHandleForUpdate = canvas.append("g")
                .attr("class", "y axis")
                .call(yAxis);

                yAxisHandleForUpdate.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Value");

                var updateBars = function(data) {
                    // First update the y-axis domain to match data
                    yScale.domain( d3.extent(data) );
                    yAxisHandleForUpdate.call(yAxis);

                    var bars = canvas.selectAll(".bar").data(data);

                    // Add bars for new data
                    bars.enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", function(d,i) { return xScale( nutritionFields[i] ); })
                    .attr("width", xScale.rangeBand())
                    .attr("y", function(d,i) { return yScale(d); })
                    .attr("height", function(d,i) { return height - yScale(d); });

                    // Update old ones, already have x / width from before
                    bars
                    .transition().duration(250)
                    .attr("y", function(d,i) { return yScale(d); })
                    .attr("height", function(d,i) { return height - yScale(d); });

                    // Remove old ones
                    bars.exit().remove();
                  };

                // Handler for dropdown value change
                var dropdownChange = function() {
                  var newCereal = d3.select(this).property('value'),
                  newData   = cerealMap[newCereal];

                  updateBars(newData);
                };

                // Get names of cereals, for dropdown
                var cereals = Object.keys(cerealMap).sort();

                var dropdown = d3.select("#vis-container")
                .insert("select", "svg")
                .on("change", dropdownChange);

                dropdown.selectAll("option")
                .data(cereals)
                .enter().append("option")
                .attr("value", function (d) { return d; })
                .text(function (d) {
                        return d[0].toUpperCase() + d.slice(1,d.length); // capitalize 1st letter
                      });

                var initialData = cerealMap[ cereals[0] ];
                updateBars(initialData);
              };
            </script>

            <div class="text-center">
              <p>Thanks for your attention!</p>
              <button id="getMessage" class="button-font">
                Click Here to Cycle back to First Scene!
              </button>
            </div>
            <script type="text/javascript">
              document.getElementById("getMessage").onclick = function () {
                location.href = "index.html";
              };
            </script>
          </body>
          </html>